## JavaScript Testing (Jest bilan)

Bu bo'limda JavaScript kodini qanday test qilishni o'rganamiz. Biz test runner sifatida **Jest**dan foydalanamiz. Maqsad — oddiy funksiyalar, async kodlar, DOM va API chaqiruvlarini to'g'ri va sodda test qilishni bilish.

### 1. Test muhiti: Node vs Browser

JavaScript ikki joyda ishlaydi:

- **Node**: serverda (backend), terminalda ishlaydi
- **Browser**: foydalanuvchi brauzerida ishlaydi

Jest odatda **Node muhitida** ishlaydi. Lekin agar siz DOM bilan ishlasangiz, Jest **jsdom** yordamida brauzer muhitini taqlid qiladi.

### 2. Test runner tanlash: Jest

Jest — yangi boshlovchilar uchun juda qulay:

- o'rnatish oson
- sozlamalari kam
- kuchli assertionlar mavjud
- mock qilish imkoniyati bor

Biz shu kursda **Jest**dan foydalanamiz.

### 3. Assertions va Matchers

**Assertion** — testda kutilgan natijani tekshirish.

Misol:

```javascript
expect(sum(2, 3)).toBe(5);
```

Mashhur matcherlar:

- `toBe()` — aniq tenglik
- `toEqual()` — obyektlarni solishtirish
- `toBeTruthy()` — true bo'lishi
- `toContain()` — array yoki string ichida borligini tekshirish

### 4. Funksiya uchun unit test yozish

Misol funksiya:

```javascript
function multiply(a, b) {
  return a * b;
}
```

Test:

```javascript
test("multiply 3 and 4 returns 12", () => {
  expect(multiply(3, 4)).toBe(12);
});
```

Bu eng oddiy unit test hisoblanadi.

### 5. Async kodlarni test qilish

Promise yoki async funksiyalarni test qilish uchun `async/await` ishlatiladi:

```javascript
test("getUser returns user data", async () => {
  const user = await getUser();
  expect(user.name).toBe("Ali");
});
```

**Timerlar** bilan test:

```javascript
jest.useFakeTimers();
```

Bu orqali vaqtni nazorat qilamiz, flaky testlardan qochamiz.

### 6. Mocking: modul va funksiyalarni almashtirish

Real API chaqirish o'rniga testda soxta javob beramiz:

```javascript
jest.mock("./api");
```

Mockingning maqsadi:

- testni tez ishlatish
- tashqi servisga bog'liq bo'lmaslik

### 7. DOM kodlarni test qilish (jsdom)

Agar siz DOM elementlarini test qilmoqchi bo'lsangiz:

```javascript
document.body.innerHTML = `<button id="btn">Click</button>`;
```

So'ngra:

```javascript
const btn = document.querySelector("#btn");
expect(btn.textContent).toBe("Click");
```

Jest jsdom bilan DOMni emulyatsiya qiladi.

### 8. Fetch va API test qilish (mock bilan)

API test qilishda haqiqiy serverga chiqilmaydi. Mock bilan ishlaymiz:

```javascript
global.fetch = jest.fn(() =>
  Promise.resolve({ json: () => Promise.resolve({ ok: true }) })
);
```

Keyin testda:

```javascript
const result = await fetchData();
expect(result.ok).toBe(true);
```

### 9. Test fayl tartibi va nomlash

Oddiy va tushunarli qoidalar:

- test fayl nomi: `fileName.test.js`
- testlar odatda `__tests__` papkada yoki fayl yonida bo'ladi

Misol:

```
src/
  utils.js
  utils.test.js
```

### 10. Keng tarqalgan xatolar

Juniorlar ko'p qiladigan xatolar:

- **Shared state**: bir testdan qolgan data boshqasiga ta'sir qiladi
- **Flaky timers**: vaqtga bog'liq testlar har safar turlicha o'tadi

Yechanishi:

- Har testda kerakli data alohida yarating
- `jest.useFakeTimers()` bilan vaqtni boshqaring

---

Keyingi bo'limda React komponentlarini test qilishni o'rganamiz.
